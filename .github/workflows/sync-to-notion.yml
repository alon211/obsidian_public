name: Sync to Notion

on:
  push:
    branches: [main]
  workflow_dispatch:  # 允许手动触发

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install requests markdown2
          pip install "notion-client>=2.2.1,<3.0.0"
          pip show notion-client | grep Version

      - name: Sync to Notion
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
          NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}
          GITHUB_WORKSPACE: ${{ github.workspace }}
        run: |
          echo "GITHUB_WORKSPACE=$GITHUB_WORKSPACE"
          echo "NOTION_TOKEN length: ${#NOTION_TOKEN}"
          echo "NOTION_DATABASE_ID: $NOTION_DATABASE_ID"
          python3 .github/scripts/sync_notion.py
